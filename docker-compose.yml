version: '3.8'

services:
  diagnosis-app:
    image: dexpertmx/lead-diagnosis-app:latest
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - VOLKERN_API_KEY=${VOLKERN_API_KEY}
      - VOLKERN_BASE_URL=${VOLKERN_BASE_URL:-https://volkern.app/api}
      - VOLKERN_PROTOCOL=https
      - NEXT_PUBLIC_APP_URL=https://diagnosis.dimension.expert
      - EXECUTIONS_MODE=queue
      - EXECUTIONS_TIMEOUT=3600
      - EXECUTIONS_TIMEOUT_MAX=7200
      - OFFLOAD_MANUAL_EXECUTIONS_TO_WORKERS=true
    networks:
      - DXnet
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.diagnosis-app.rule=Host(`diagnosis.dimension.expert`)"
      - "traefik.http.routers.diagnosis-app.entrypoints=websecure"
      - "traefik.http.routers.diagnosis-app.tls.certresolver=myresolver"
      - "traefik.http.services.diagnosis-app.loadbalancer.server.port=3000"

networks:
  DXnet:
    external: true
